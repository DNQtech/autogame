# 🚀 v2多开智能游戏自动化系统

## 📖 系统简介

v2多开智能游戏自动化系统是一个全新升级的游戏自动化解决方案，支持：

- ✅ **多窗口同时控制** - 同时管理多个游戏窗口实例
- ✅ **非激活窗口操作** - 在窗口未激活状态下进行自动化操作  
- ✅ **自适应分辨率** - 根据窗口截图自动适配不同分辨率
- ✅ **智能装备检测** - 基于OpenCV模板匹配的装备识别
- ✅ **独立窗口管理** - 每个窗口独立的战斗、移动、拾取循环
- ✅ **线程安全设计** - 多线程并发控制，资源隔离

## 🏗️ 系统架构

```
v2多开智能游戏系统
├── 多窗口管理器 (MultiWindowManager)
│   ├── 窗口扫描与发现
│   ├── 窗口信息管理
│   ├── 非激活窗口截图
│   └── 窗口消息发送
├── 智能游戏控制器 (IntelligentGameController)
│   ├── 自适应分辨率设置
│   ├── 装备检测与拾取
│   ├── 智能战斗控制
│   └── 随机移动系统
└── 主系统管理 (V2MultiGameSystem)
    ├── 控制器生命周期管理
    ├── 交互式控制台
    └── 系统状态监控
```

## 🔧 核心组件

### 1. 多窗口管理器 (`multi_window_manager.py`)
- **窗口发现**: 自动扫描并识别游戏窗口
- **非激活截图**: 使用MSS库实现后台窗口截图
- **消息发送**: 通过Windows API发送鼠标键盘消息
- **窗口验证**: 实时检查窗口状态和有效性

### 2. 智能游戏控制器 (`intelligent_game_controller.py`)
- **自适应设置**: 根据窗口尺寸自动调整参数
- **装备系统**: 队列化装备检测与智能拾取
- **战斗系统**: 随机移动 + 技能攻击组合
- **线程管理**: 独立的控制循环和装备监控线程

### 3. 主系统管理 (`v2_multi_game_system.py`)
- **系统协调**: 统一管理所有窗口和控制器
- **交互界面**: 提供友好的控制台操作界面
- **状态监控**: 实时显示系统和控制器状态
- **生命周期**: 自动创建、启动、停止控制器

## ⚙️ 配置说明

### 目标游戏配置 (`config.py`)

```python
# 添加你的游戏进程名
TARGET_PROCESSES = [
    'your_game.exe',    # 你的游戏进程名
    'game_client.exe',  # 游戏客户端
]

# 添加游戏窗口标题关键词
GAME_WINDOW_KEYWORDS = [
    '你的游戏名称',
    'Your Game Title',
]
```

### 控制参数调整

```python
CONTROLLER_CONFIG = {
    'fight_interval': 1.5,          # 攻击间隔（秒）
    'move_interval': 2.0,           # 移动间隔（秒）
    'equipment_check_interval': 0.5, # 装备检测间隔（秒）
    'movement_radius': 100,         # 移动半径（像素）
}
```

## 🚀 快速开始

### 1. 环境准备

确保已安装必要的Python库：

```bash
pip install opencv-python numpy pillow mss psutil pywin32
```

### 2. 装备模板准备

在 `../templates/` 目录下放置装备图片模板：
- 支持 `.jpg`, `.png`, `.bmp` 格式
- 建议尺寸: 32x32 到 64x64 像素
- 文件名即为装备名称

### 3. 启动系统

```bash
cd v2
python v2_multi_game_system.py
```

### 4. 操作流程

1. **启动系统** - 自动扫描游戏窗口
2. **查看状态** - 选择菜单项1查看发现的窗口
3. **启动控制** - 选择菜单项2启动所有控制器
4. **监控运行** - 实时查看各窗口的自动化状态

## 📋 功能特性

### 🎮 多窗口支持
- 同时控制多个游戏窗口
- 每个窗口独立的自动化循环
- 窗口状态实时监控

### 🖥️ 非激活操作
- 后台窗口截图技术
- Windows消息API直接操作
- 不影响当前活动窗口

### 📐 自适应分辨率
- 自动检测窗口尺寸
- 动态调整操作坐标
- 支持任意分辨率游戏

### 🎯 智能装备系统
- OpenCV模板匹配检测
- 队列化装备管理
- 多种拾取方式尝试
- 拾取成功验证

### ⚔️ 智能战斗系统
- 随机移动避免检测
- 多技能组合攻击
- 战斗区域限制
- 攻击间隔控制

## 🔍 调试功能

### 截图调试
```python
# 在config.py中启用
DEBUG_CONFIG = {
    'save_screenshots': True,       # 保存调试截图
    'show_detection_boxes': True,   # 显示检测框
}
```

### 详细日志
```python
LOGGING_CONFIG = {
    'level': 'DEBUG',               # 启用详细日志
    'verbose_logging': True,        # 详细日志模式
}
```

## ⚠️ 注意事项

### 系统要求
- Windows 10/11 操作系统
- Python 3.7+ 环境
- 管理员权限（部分功能需要）

### 游戏兼容性
- 支持大多数Windows游戏
- 需要游戏窗口可见（不能最小化）
- 某些全屏游戏可能需要窗口化模式

### 安全建议
- 仅用于个人学习和测试
- 遵守游戏服务条款
- 建议在测试环境使用

## 🐛 故障排除

### 常见问题

**Q: 找不到游戏窗口？**
A: 检查 `config.py` 中的进程名和窗口关键词配置

**Q: 截图失败？**
A: 确保游戏窗口未最小化，且有足够的系统权限

**Q: 装备检测不准确？**
A: 调整检测阈值，或更新装备模板图片

**Q: 控制器无响应？**
A: 检查游戏是否支持后台操作，或尝试窗口化模式

### 日志分析
系统提供详细的日志输出，可以通过日志定位问题：
- `[MANAGER]` - 窗口管理相关
- `[CONTROLLER]` - 控制器相关  
- `[EQUIPMENT]` - 装备检测相关
- `[COMBAT]` - 战斗控制相关

## 📈 性能优化

### 系统资源
- 默认限制最大10个控制器
- 截图缓存减少重复截图
- 线程池管理避免资源浪费

### 检测优化
- 调整装备检测间隔
- 使用合适的模板尺寸
- 限制检测区域范围

## 🔄 版本对比

| 功能 | v1版本 | v2版本 |
|------|--------|--------|
| 多窗口支持 | ❌ | ✅ |
| 非激活操作 | ❌ | ✅ |
| 自适应分辨率 | ❌ | ✅ |
| 智能控制器 | ❌ | ✅ |
| 交互式界面 | ❌ | ✅ |
| 线程安全 | ⚠️ | ✅ |

## 🤝 贡献指南

欢迎提交Issue和Pull Request来改进系统！

## 📄 许可证

本项目仅供学习和研究使用。
