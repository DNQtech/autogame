# 🎮 游戏自动化系统使用指南

本指南将帮助您快速上手和优化游戏自动化系统，实现装备检测、自动打怪和智能拾取功能。

## 🚀 快速开始

### 第一步：环境准备

1. **系统要求**
   - Windows 操作系统
   - Python 3.8 或更高版本
   - 1920x1080 分辨率显示器（推荐）
   - 至少 4GB 内存

2. **安装依赖**
   ```bash
   # 在项目目录下执行
   pip install -r requirements.txt
   ```

3. **验证安装**
   ```bash
   python -c "import cv2, mss, pyautogui, keyboard; print('依赖安装成功!')"
   ```

### 第二步：准备装备模板

1. **截取装备图标**
   - 在游戏中找到您想要检测的装备
   - 使用截图工具精确截取装备图标
   - 确保图片清晰、尽量只包含装备图标

2. **图片要求**
   - **尺寸**：20x20 到 200x200 像素
   - **格式**：PNG格式（推荐）
   - **质量**：清晰、无模糊
   - **背景**：尽量简单，避免复杂背景

3. **保存模板**
   ```
   项目目录/
   ├── templates/
   │   ├── 装妇1.png      # 第一个装备模板
   │   ├── 装妇2.png      # 第二个装备模板
   │   └── 装妇3.png      # 更多装备模板...
   └── start_game.py
   ```

### 第三步：第一次运行

1. **启动游戏**
   - 打开您的游戏
   - 确保游戏窗口处于前台
   - 进入游戏主界面

2. **运行系统**
   ```bash
   python start_game.py
   ```

3. **观察输出**
   您应该看到类似以下的输出：
   ```
   ✅ [系统状态] 装备检测正常 | 自动打怪正常 | 自动拾取就绪
   🔍 [装备检测] 持续监控装备掉落...
   [MOVE] 随机移动: (960, 540) [计数: 1/30]
   [ATTACK] 攻击技能: (960, 540)
   ```
detector.load_templates_from_folder("templates")

# 方法2：单独加载装备图片
# detector.load_equipment_template("my_sword.png", "我的神剑")
# detector.load_equipment_template("epic_armor.png", "史诗护甲")

# 设置检测区域（可选，默认全屏）
# detector.set_detection_region(100, 100, 1720, 880)  # 游戏窗口区域

# 设置匹配精度（可选，默认0.7）
detector.set_match_threshold(0.8)  # 0.8 = 80%相似度才算匹配

# 查看已加载的模板
detector.list_loaded_templates()

# 开始实时检测
print("开始监控装备掉落...")
detector.start_realtime_detection(equipment_found_alert, fps=5)

try:
    # 让程序持续运行，监控装备
    while True:
        time.sleep(1)
        
except KeyboardInterrupt:
    print("停止检测...")
    detector.stop_realtime_detection()
```

### 第四步：运行检测器

```bash
python my_detector.py
```

## ⚙️ 参数调优

### 1. 匹配阈值调整
```python
# 如果检测太敏感（误报多）
detector.set_match_threshold(0.9)  # 提高到90%

# 如果检测不够敏感（漏检多）
detector.set_match_threshold(0.6)  # 降低到60%
```

### 2. 检测频率调整
```python
# 高频检测（更及时，但CPU占用高）
detector.start_realtime_detection(callback, fps=20)

# 低频检测（省CPU，但可能错过瞬间掉落）
detector.start_realtime_detection(callback, fps=3)
```

### 3. 检测区域优化
```python
# 只检测游戏窗口，避免检测到其他程序
detector.set_detection_region(0, 0, 1920, 1080)

# 只检测装备掉落区域（如果知道固定位置）
detector.set_detection_region(500, 300, 900, 600)
```

## 🎮 实际使用示例

### 示例1：监控特定装备
```python
detector = TemplateEquipmentDetector()

# 加载你想要的装备图片
detector.load_equipment_template("屠龙刀.png", "屠龙刀")
detector.load_equipment_template("倚天剑.png", "倚天剑")

# 自定义警报函数
def my_alert(match):
    if match.confidence > 0.9:  # 高置信度才警报
        print(f"🚨 发现 {match.equipment_name}! 快去拾取!")
        # 这里可以添加声音警报、发送通知等

detector.start_realtime_detection(my_alert, fps=10)
```

### 示例2：批量监控
```python
detector = TemplateEquipmentDetector()

# 从文件夹加载所有装备
count = detector.load_templates_from_folder("我的装备库")
print(f"加载了 {count} 种装备")

# 开始监控
detector.start_realtime_detection(equipment_found_alert, fps=5)
```

## 🔧 故障排除

### 1. 检测不到装备
- 检查图片质量是否清晰
- 降低匹配阈值：`detector.set_match_threshold(0.5)`
- 确认检测区域包含装备出现位置
- 尝试截取更大或更小的装备图片

### 2. 误报太多
- 提高匹配阈值：`detector.set_match_threshold(0.9)`
- 截取更精确的装备图片（去除背景）
- 缩小检测区域

### 3. 性能问题
- 降低检测频率：`fps=3`
- 缩小检测区域
- 减少加载的模板数量

## 📊 性能对比

| 检测方法 | 速度 | 精确度 | 适用场景 |
|---------|------|--------|----------|
| OCR文字识别 | 21秒 | 高 | 文字装备名 |
| 颜色检测 | 17ms | 中 | 按品质检测 |
| 模板匹配 | 50-200ms | 极高 | 特定装备 |

## 💡 最佳实践

1. **图片准备**：截取清晰、对比度高的装备图标
2. **阈值设置**：从0.8开始，根据效果调整
3. **区域设置**：只检测装备可能出现的区域
4. **频率控制**：5-10 FPS通常足够，太高浪费CPU
5. **模板管理**：按装备类型分文件夹组织

现在你可以使用自己的装备图片进行精确检测了！🎯
